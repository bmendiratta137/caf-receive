<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: core.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: core.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import Log from './log'
import Backend from './backend'

/**
 * Static class that sums up core functionalities of the library.
 * @static
 */
class Core {
  /**
   * Add a tracker to the system. Trackers added will start reporting its events to NR's backend.
   *
   * @param {(Emitter|Tracker)} tracker Tracker instance to add.
   */
  static addTracker (tracker) {
    if (tracker.on &amp;&amp; tracker.emit) {
      trackers.push(tracker)
      tracker.on('*', eventHandler)
    } else {
      Log.error('Tried to load a non-tracker.', tracker)
    }
  }

  /**
   * Disposes and remove given tracker. Removes its listeners.
   *
   * @param {Tracker} tracker Tracker to remove.
   */
  static removeTracker (tracker) {
    tracker.off('*', eventHandler)
    tracker.dispose()
    let index = trackers.indexOf(tracker)
    if (index !== -1) trackers.splice(index, 1)
  }

  /**
   * Returns the array of trackers.
   *
   * @returns {Tracker[]} Array of trackers.
   */
  static getTrackers () {
    return trackers
  }

  /**
   * Returns the current backend.
   *
   * @returns {Backend} The current backend.
   */
  static getBackend() {
    return backend
  }

  /**
   * Sets the current backend.
   * @param {Backend} backendInstance Backend instance.
   */
  static setBackend(backendInstance) {
      backend = backendInstance
  }

  /**
   * Sends given event using the appropriate backend.
   * @param {String} event Event to send.
   * @param {Object} data Data associated to the event.
   */
  static send(event, data) {
    if (Core.getBackend() == undefined || !(Core.getBackend() instanceof Backend)) {
        // Use the default backend (NR Agent)
        if (typeof newrelic !== 'undefined' &amp;&amp; newrelic.addPageAction) {
            newrelic.addPageAction(event, data)
        } else {
            if (!isErrorShown) {
                Log.error(
                    'newrelic.addPageAction() is not available.',
                    'In order to use NewRelic Video you will need New Relic Browser Agent.'
                )
                isErrorShown = true
            }
        }
    }
    else {
        // Use the user-defined backend
        Core.getBackend().send(event, data)
    }
  }

  /**
   * Sends an error event. This may be used for external errors launched by the app, the network or
   * any external factor. Note that errors within the player are normally reported with
   * tracker.sendError, so this method should not be used to report those.
   *
   * @param {object} att attributes to be sent along the error.
   */
  static sendError (att) {
    Core.send('ERROR', att)
  }
}

let trackers = []
let backend;
let isErrorShown = false

/**
 * Logs and sends given event.
 *
 * @private
 * @param {Event} e Event
 */
function eventHandler (e) {
  let data = cleanData(e.data)
  if (Log.level &lt;= Log.Levels.DEBUG) {
    Log.notice('Sent', e.type, data)
  } else {
    Log.notice('Sent', e.type)
  }
  Core.send(e.type, data)
}

/**
 * Cleans given object, removing all items with value === null.
 * @private
 * @param {Object} data Data to clean
 * @returns {Object} Cleaned object
 */
function cleanData (data) {
  let ret = {}
  for (let i in data) {
    if (data[i] !== null &amp;&amp; typeof data[i] !== 'undefined') ret[i] = data[i]
  }
  return ret
}

export default Core
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Backend.html">Backend</a></li><li><a href="Chrono.html">Chrono</a></li><li><a href="Constants.html">Constants</a></li><li><a href="Core.html">Core</a></li><li><a href="Emitter.html">Emitter</a></li><li><a href="Log.html">Log</a></li><li><a href="NRInsightsBackend.html">NRInsightsBackend</a></li><li><a href="Tracker.html">Tracker</a></li><li><a href="VideoTracker.html">VideoTracker</a></li><li><a href="VideoTrackerState.html">VideoTrackerState</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.4</a> on Thu Apr 23 2020 14:21:01 GMT+0200 (CEST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
